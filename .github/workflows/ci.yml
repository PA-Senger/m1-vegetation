name: CMake

on: [push]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: RelWithDebInfo

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Step to verify Python availability
      - name: Check Python version
        run: python3 --version

      # Step to set up Python virtual environment and install dependencies
      - name: Install conan and dependencies
        shell: bash
        run: |
          python3 -m venv .venv
          source .venv/bin/activate
          pip3 install --upgrade pip
          pip3 install -r requirements.txt

      # Step to debug virtual environment
      - name: List directory contents
        run: ls -la

      # Step to configure CMake
      - name: Configure CMake
        shell: bash
        run: |
          source .venv/bin/activate
          cmake --preset default

      # Step to build the project
      - name: Build
        shell: bash
        run: cmake --build --preset default

      # Step to run tests
      - name: Test
        shell: bash
        run: ctest --preset default
